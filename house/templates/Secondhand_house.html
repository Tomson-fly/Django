<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>二手房产</title>
    <link rel="stylesheet" href="/static/js/css/layui.css">
     <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <style>
        #container{
           margin-right:60px;
            margin-left:60px;
            margin-top: 15px;
        }
    </style>
</head>
<body>

<div class="layui-layout layui-layout-admin">
  <div class="layui-header">
            <div class="layui-logo layui-hide-xs layui-bg-black">
         <i class="layui-icon" style=font-size:35px;">&#xe62e;</i>
{#         <i class="layui-icon layui-icon-home" style=font-size:30px;"></i>#}
        目录
    </div>
    <!-- 头部区域（可配合layui 已有的水平导航） -->
    <ul class="layui-nav layui-layout-left">
      <!-- 移动端显示 -->
      <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
        <i class="layui-icon layui-icon-spread-left"></i>
      </li>

      <li class="layui-nav-item layui-hide-xs"><a href="">二手房产信息</a></li>



    </ul>
    <ul class="layui-nav layui-layout-right">
      <li class="layui-nav-item layui-hide layui-show-md-inline-block">
        <a href="javascript:;">
          <img src="//tva1.sinaimg.cn/crop.0.0.118.118.180/5db11ff4gw1e77d3nqrv8j203b03cweg.jpg" class="layui-nav-img">
        {#          admin#}
            {% if request.session.loginUser %}
              {{ request.session.loginUser  }}
            {% endif %}
        </a>
        <dl class="layui-nav-child">
{#          <dd><a href="">Your Profile</a></dd>#}
          <dd><a href="">设置</a></dd>
          <dd><a href="/first/denglu/">退出</a></dd>
        </dl>
      </li>

      <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
        <a href="javascript:;">
          <i class="layui-icon layui-icon-more-vertical"></i>
        </a>
      </li>
    </ul>
  </div>


<div class="layui-side layui-bg-black">
    <div class="layui-side-scroll">
      <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
      <ul class="layui-nav layui-nav-tree" lay-filter="test">
         <li class="layui-nav-item layui-nav-itemed">
          <a class="" href="/first/test/">
<i class="layui-icon layui-icon-home" style=font-size:15px;"></i>
              可视化首页</a>
        </li>
        <li class="layui-nav-item layui-nav-itemed">
          <a class="" href="javascript:;">
             <i class="layui-icon">&#xe630;</i>
              房屋信息管理</a>
          <dl class="layui-nav-child">
            <dd><a href="/first/unsoldhouse/"><i class="layui-icon">&#xe62d;</i>未售房产信息管理</a></dd>
            <dd><a href="/first/secondhandhouse/"><i class="layui-icon">&#xe62d;</i>二手房产信息管理</a></dd>
            <dd><a href="/first/buyhouse/"><i class="layui-icon">&#xe62d;</i>出租房屋信息管理</a></dd>
{#            <dd><a href="javascript:;">分析</a></dd>#}
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">
               <i class="layui-icon">&#xe63c;</i>
{#              <i class="layui-icon">&#xe624;</i>#}
              房屋信息发布</a>
          <dl class="layui-nav-child">
            <dd><a href="/first/addnew/"><i class="layui-icon">&#xe624;</i>未售房产信息发布</a></dd>
            <dd><a href="/first/addsec/"><i class="layui-icon">&#xe624;</i>二手房产信息发布</a></dd>
            <dd><a href="/first/addrent/"><i class="layui-icon">&#xe624;</i>出租房屋信息发布</a></dd>
{#            <dd><a href="javascript:;">分析</a></dd>#}
          </dl>
        </li>
        <li class="layui-nav-item">
          <a href="javascript:;">             <i class="layui-icon">&#xe630;</i>求租信息管理</a>
          <dl class="layui-nav-child">
            <dd><a href="/first/quanzi/"><i class="layui-icon">&#xe62a;</i>求租信息管理</a></dd>
            <dd><a href="/first/rentissue/"><i class="layui-icon">&#xe63c;</i>求租信息发布</a></dd>
{#            <dd><a href="javascript:;">分析</a></dd>#}
{#            <dd><a href="">超链接</a></dd>#}
          </dl>
        </li>
<!--        <li class="layui-nav-item layui-nav-itemed">-->
<!--          <a class="" href="javascript:;">-->
<!--              <i class="layui-icon">&#xe629; </i>-->
<!--              房产信息可视化</a>-->
<!--          <dl class="layui-nav-child">-->
<!--            <dd><a href="/first/test/">-->
<!--                <i class="layui-icon">&#xe62c;</i>-->
<!--                 信息可视化-->
<!--            </a></dd>-->
<!--{#            <dd><a href="javascript:;">分析</a></dd>#}-->
<!--          </dl>-->
<!--        </li>-->
        <li class="layui-nav-item"><a href="/first/about/">

             <i class="layui-icon">&#xe612;</i>
            关于我们</a></li>
      </ul>
    </div>
  </div>


<div class="layui-body">

    <div class="searchTable" id="searchTable">
      <div class="" style="padding: 15px 0;">
           <blockquote class="layui-elem-quote" style="color: #666;">
              <div class="layui-inline">
                   <input class="layui-input layui-inline"  id="community" placeholder="请输入小区名" autocomplete="off"   style="display:inline;width: auto;margin-left: 15px;" />
                   <button class="layui-btn" data-type="reload" id="search"  style="margin-left: 15px;" >搜索</button>
               </div>
          </blockquote>
      </div>
      <div id="container">
           <table class="layui-hide" lay-filter="test" id="test"></table>
      </div>
<div style="display: none;padding: 20px" id="saveOrUpdateDiv1" >
    <form class="layui-form"  lay-filter="dataFrm1" id="dataFrm1">
        {% csrf_token %}
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">小区名:</label>
                <div class="layui-input-inline">
                    <input type="hidden" name="id">
                    <input type="text" name="community" lay-verify="required"   placeholder="请输入小区名" autocomplete="off"
                           class="layui-input">
                </div>
            </div>

            <div class="layui-inline">
                <label class="layui-form-label">参考价格:</label>
                <div class="layui-input-inline">
                    <input type="text" name="price" lay-verify="required"  placeholder="请输入参考价格" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">户型:</label>
                <div class="layui-input-inline">
                    <input type="text" name="type" lay-verify="required"  placeholder="请输入户型" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
                        <div class="layui-inline">
                <label class="layui-form-label">面积:</label>
                <div class="layui-input-inline">
                    <input type="text" name="area" lay-verify="required"  placeholder="请输入面积" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="text-align: center;">
            <div class="layui-input-block">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-sm layui-icon layui-icon-release" lay-filter="doEditSubmit" lay-submit="">提交</button>
                <button type="reset" class="layui-btn layui-btn-warm layui-btn-sm layui-icon layui-icon-refresh" >重置</button>
            </div>
        </div>
    </form>
    </div>
</div>


    <script  type="text/html" id="barDemo">
        <button type="button" class="layui-btn layui-btn-sm" lay-event="edit">编辑</button>
        <button type="button" class="layui-btn layui-btn-sm" lay-event="del" >删除</button>
    </script>
    <script src="/static/js/layui.js"></script>
    <script src="/static/js/jquery-3.1.1.min.js"></script>
    <script>
        layui.use(['table','form'], function(){
            var table = layui.table;
            var form = layui.form;
            var mainIndex;
            tableIns=table.render({
                elem: '#test'
                ,url:'/first/showbypageecond/'
                ,limit:10
                ,limits:[10,20,30]
                ,cols:[[
                    {#{type:'checkbox',fixed:'left'},#}
                    {field: 'id', title: 'ID', sort: true, fixed: 'left', width: 100},
                    {field: 'community', title: '小区名', width: 180},
                    {field: 'price', sort: true, title: '参考价格（万）', width: 170},
                    {field: 'type', title: '户型', width: 140},
                    {field: 'area', sort: true, title: '面积（平方米）', width: 170},
                    {title:'操作',minWidth:'140',algin:'center',toolbar:'#barDemo'}
                ]]
                ,page:true
                ,loading: false
            });


            table.on('tool(test)', function(obj){
                var data = obj.data;
                console.log(data);
                if(obj.event === 'del'){
                    layer.confirm('真的删除行么', function(index){
                        $.ajax({
                            url: "/first/drop_sec/",
                            type: "POST",
                            data:{"id":data.id,
                                    csrfmiddlewaretoken:$("input[name='csrfmiddlewaretoken']").val()
                                  },
                            dataType: "json",
                            success: function(data){
                                obj.del();
                                layer.close(index);
                                layer.msg("删除成功", {icon: 6});
                                tableIns.reload();
                            },
                            error:function (data) {
                                layer.msg("删除失败", {icon: 5});
                            }
                        });
                    });
                } else if(obj.event === 'edit'){
                    openUserUpdate(data);
                }
            });
            function openUserUpdate(data) {
                mainIndex=layer.open({
                    type:1,
                    title:'编辑二手房产信息',
                    shade:0.0,
                    content:$("#saveOrUpdateDiv1"),
                    area:['800px','400px'],
                    success:function(index){
                        form.val("dataFrm1",data);
                    },end:function(){ // 未点击确定按钮，点击关闭按钮
　　　　　　          $("#saveOrUpdateDiv1").css("display","none");
　　　　            }
                });
            }
            form.on("submit(doEditSubmit)",function(obj){
                 $.post("/first/update_sec/",form.val('dataFrm1'),function(obj){
                     layer.msg(obj.msg);
                     //关闭弹出层
                     layer.close(mainIndex);
                     $("#saveOrUpdateDiv1").css("display","none");
                     //刷新数据 表格
                     tableIns.reload();
                 })
            });
             //以下是搜索框进行监测
            var active = {
                    reload: function(){
                     var index = layer.msg('查询中，请稍后...', { icon: 16, time: false, shade: 0 });
                    setTimeout(function () {
                        table.reload('test', {
                            page: {
                                curr:1
                            }, where: {
                                community:$('#community').val(),
                            }
                        })
                        layer.close(index);
                    },800)
                }
            };

             $('#search').on('click', function () {
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            })

        });
    </script>
</div>
{#    下面的语句不能引入两次#}
{#<script src="/static/js/layui.js"></script>#}
<script>
    //JS
    layui.use(['element', 'layer', 'util'], function(){
      var element = layui.element
      ,layer = layui.layer
      ,util = layui.util
      ,$ = layui.$;


      //头部事件
      util.event('lay-header-event', {
        //左侧菜单事件
        menuLeft: function(othis){
          layer.msg('展开左侧菜单的操作', {icon: 0});
        }
        ,menuRight: function(){
          layer.open({
            type: 1
            ,content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
            ,area: ['260px', '100%']
            ,offset: 'rt' //右上角
            ,anim: 5
            ,shadeClose: true
          });
        }
      });
    });
</script>
</body>

</html>
